Option Explicit
'Hyeongwan Seo <westporch@gmail.com>
'https://github.com/westporch/Creating_charts_using_VBA.git
'Macro_Test.xlsm.txt파일은 Macro_test.xlsm의 VBA 소스를 txt로 정리한 것 입니다. _
 엑셀에서 전체 소스 확인 방법: Macro_Test.xlsm 실행 -> 개발자 도구 -> Visual Basic 항목 클릭.
 
Public idx As Integer
Public idx_cpu As Integer
Public 변경한_Sheet2_이름 As String
Public 변경한_Sheet3_이름 As String


'엑셀 실행 시 호출되는 Auto_Open()을 재정의함.
Sub Auto_Open()

    시트2_이름_변경
    시트3_이름_변경
    시트의_셀_초기화
    
    '메모리 사용량 그래프를 그린다
   get_mem_statistics
   mem차트를_그릴_영역_선택
   mem차트_생성_후_크기위치_변경
   mem차트_제목_설정
   생성된_mem차트를_메인시트에_복사
   
   'config_gathering 정보 출력
   get_Config_gathering_sysinfo
   Worksheets("Sheet1").Activate
   
   'CPU 사용량 그래프를 그린다
   get_cpu_statistics
   cpu차트를_그릴_영역_선택
   cpu차트_생성_후_크기위치_변경
   cpu차트_제목_설정
   생성된_cpu차트를_메인시트에_복사
   
End Sub

'전체 데이터 시트의 셀을 삭제한다.
Function 시트의_셀_초기화()

    Sheets("Sheet1").Cells.Delete
    Sheets("메모리_사용량_기록").Cells.Delete
    Sheets("CPU_사용량_기록").Cells.Delete
    
End Function


Function 시트2_이름_변경()
    
    변경한_Sheet2_이름 = "메모리_사용량_기록"
    
    '시트2 이름 변경
    If IsSheet(변경한_Sheet2_이름) = True Then
        'MsgBox "동일한 시트명이 존재합니다."
        Worksheets(변경한_Sheet2_이름).Activate
    Else
        Worksheets("Sheet2").Name = 변경한_Sheet2_이름
    End If
    
    
End Function

Function IsSheet(시트명 As String) As Boolean
    
    Dim 시트 As Worksheet
    
    On Error Resume Next
        Set 시트 = Worksheets(시트명)
        IsSheet = (Err.Number = 0)      ' 리턴값이 저장됨.
        
End Function

Function 시트3_이름_변경()
    
    변경한_Sheet3_이름 = "CPU_사용량_기록"
    
    '시트3 이름 변경
    If IsSheet(변경한_Sheet3_이름) = True Then
        'MsgBox "동일한 시트명이 존재합니다."
        Worksheets(변경한_Sheet3_이름).Activate
    Else
        Worksheets("Sheet3").Name = 변경한_Sheet3_이름
    End If
    
End Function


'Config_gathering의 시스템 정보를 가져옴
Function get_Config_gathering_sysinfo()
     ' Config_gathering의 불필요한 정보 삭제 (시스템 정보만 남기기 위한 작업)
    Workbooks.Open Filename:="C:\Temp\201512071330_config_gathering.txt"
       
    With Range("A37:A3000")
        .Select
        .Delete Shift:=xlShiftUp
    End With

    ' Config_gathering의 시스템 정보 부분만 선택 후 복사
    With Range("A1:A36")
        .Select
        .Copy
    End With

    ' Config_gathering에서 시스템 정보만 수집한 뒤 해당 파일을 닫는다.
    Workbooks("201512071330_config_gathering.txt").Close SaveChanges:=False
   
   ' 복사한 셀을 붙여넣는다.
   ActiveSheet.Paste Destination:=Worksheets("Sheet1").Range("A1")
   
End Function